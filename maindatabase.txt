-- Create the database
CREATE DATABASE IF NOT EXISTS dashboard_db;
USE dashboard_db;

-- Users table
CREATE TABLE users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL,
    contact VARCHAR(20),
    profile_picture VARCHAR(255),
    role ENUM('admin', 'user') DEFAULT 'user',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Population data table
CREATE TABLE pop_data (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    age INT NOT NULL,
    sex ENUM('male', 'female', 'lgbtq') NOT NULL,
    barangay VARCHAR(50) NOT NULL,
    address VARCHAR(255) NOT NULL,
    contact VARCHAR(20) NOT NULL,
    birthday DATE NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- Events table
CREATE TABLE events (
    id INT AUTO_INCREMENT PRIMARY KEY,
    title VARCHAR(255) NOT NULL,
    description TEXT,
    start_date DATE NOT NULL,
    end_date DATE,
    time TIME,
    type VARCHAR(50),
    user_id INT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);

-- Settings table
CREATE TABLE settings (
    id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL,
    theme VARCHAR(20) DEFAULT 'light',
    refresh_interval INT DEFAULT 30,
    timezone VARCHAR(50) DEFAULT 'UTC',
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);

-- Insert default admin user
INSERT INTO users (name, email, password, role) VALUES 
('Admin', 'admin@example.com', '$2y$10$YourHashedPasswordHere', 'admin');

-- Sample barangay data
INSERT INTO pop_data (name, age, sex, barangay, address, contact, birthday) VALUES 
('John Doe', 25, 'male', 'Barangay 1', '123 Main St', '09123456789', '1998-05-15'),
('Jane Smith', 30, 'female', 'Barangay 2', '456 Park Ave', '09187654321', '1993-08-22'),
('Alex Rivera', 28, 'lgbtq', 'Barangay 3', '789 Rainbow St', '09456123789', '1995-12-10');

-- Sample events
INSERT INTO events (title, description, start_date, type, user_id) VALUES 
('Community Meeting', 'Monthly community gathering', '2025-08-15', 'meeting', 1),
('Health Program', 'Free medical checkup', '2025-08-20', 'health', 1);

-- Create indexes for better performance
CREATE INDEX idx_pop_data_barangay ON pop_data(barangay);
CREATE INDEX idx_pop_data_sex ON pop_data(sex);
CREATE INDEX idx_events_date ON events(start_date);
